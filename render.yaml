services:
  - type: web
    name: clm-backend
    runtime: python3
    buildCommand: |
      python --version &&
      pip install --upgrade pip setuptools wheel &&
      pip install --upgrade pip &&
      pip install setuptools>=65.0.0 wheel>=0.37.0 &&
      pip install -r requirements.txt --no-cache-dir
    startCommand: |
      if [ -f "/opt/render/project/.venv/bin/python" ]; then
        /opt/render/project/.venv/bin/python -m gunicorn clm_backend.wsgi:application --bind 0.0.0.0:$PORT --workers 1 --threads 1 --timeout 30
      elif [ -f "/opt/render/.venv/bin/python" ]; then
        /opt/render/.venv/bin/python -m gunicorn clm_backend.wsgi:application --bind 0.0.0.0:$PORT --workers 1 --threads 1 --timeout 30
      else
        python -m gunicorn clm_backend.wsgi:application --bind 0.0.0.0:$PORT --workers 1 --threads 1 --timeout 30
      fi
    envVars:
      - key: DJANGO_SETTINGS_MODULE
        value: clm_backend.settings
      - key: DEBUG
        value: false
      - key: SECRET_KEY
        generateValue: true
      - key: PYTHON_VERSION
        value: 3.10.13
      - key: ENVIRONMENT
        value: production
    # Add your environment variables here
    # - key: DB_NAME
    #   value: your_db_name
    # - key: DB_USER
    #   value: your_db_user
    # - key: DB_PASSWORD
    #   value: your_db_password
    # - key: DB_HOST
    #   value: your_db_host
    # - key: DB_PORT
    #   value: 5432
    # - key: R2_ACCOUNT_ID
    #   value: your_r2_account_id
    # - key: R2_ACCESS_KEY_ID
    #   value: your_r2_access_key
    # - key: R2_SECRET_ACCESS_KEY
    #   value: your_r2_secret_key
    # - key: R2_BUCKET_NAME
    #   value: clm
    # - key: R2_PUBLIC_URL
    #   value: https://clm.r2.cloudflarestorage.com
    # - key: JWT_SECRET_KEY
    #   value: your_jwt_secret
    # - key: REDIS_URL
    #   value: your_redis_url
    # - key: EMAIL_HOST
    #   value: your_email_host
    # - key: EMAIL_PORT
    #   value: 587
    # - key: EMAIL_HOST_USER
    #   value: your_email_user
    # - key: EMAIL_HOST_PASSWORD
    #   value: your_email_password

databases:
  - name: clm-db
    databaseName: clm_prod
    user: clm_user
    # PostgreSQL will be automatically provisioned